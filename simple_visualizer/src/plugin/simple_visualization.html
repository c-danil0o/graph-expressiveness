{% block simple_view %}
<style>

.node {
  cursor: pointer;
  color: #3182bd;

}

.link {
  fill: none;
  stroke: #9ecae1;
  stroke-width: 1.5px;
}

</style>
<script>
    function nodeClick(el){
        console.log(el);
      // alert("ID: "+ el.textContent);
    }
</script>


<script>

    var nodes = {{ nodes | safe }}
    var links = {{ links | safe }}

    var nodes_dict = nodes.reduce(function(acc, node) {
        acc[node.node_id] = node;
        return acc;
    }, {});

    links.forEach(function(link) {
        link.source = nodes_dict[link.source];
        link.target = nodes_dict[link.target];
    });

    var force = d3.layout.force()
        .size([1000,1000])
        .nodes(d3.values(nodes))
        .links(links)
        .on("tick", tick)
        .linkDistance(300)
        .charge(-5000)
        .start();

    var drag = force.drag()
    		.on("dragstart", dragstart)
            .on("dragend", dragend);

    var zoom = d3.behavior.zoom()
        .scaleExtent([0.01, 10])
        .on("zoom", zoomed);

    var svg = d3.select('svg')
        .attr('width', 1000)
        .attr('height', 1000)
        .call(zoom);

    var container = svg.append('g');

    var link = container.selectAll('.link')
        .data(links)
        .enter().append('line')
        .attr('class', 'link');

    var node = container.selectAll('.node')
        .data(force.nodes())
        .enter().append('g')
        .attr('class', 'node')
        .attr('id', function(d) { return d.name; })
        .on('click', function() { nodeClick(this); })
        .call(drag);

    node.append('circle')
        .attr('r', 25)
        .attr('fill', 'lightgrey');

    node.append('text')
        .attr('text-anchor', 'middle')
        .attr('alignment-baseline', 'central')
        .attr('fill', 'black')
        .text(function(d) { return d.node_id; });


    function tick(e) {
        node.attr("transform", function(d) {return "translate(" + d.x + "," + d.y + ")";})
            .call(force.drag);

        link.attr('x1', function(d) { return d.source.x; })
            .attr('y1', function(d) { return d.source.y; })
            .attr('x2', function(d) { return d.target.x; })
            .attr('y2', function(d) { return d.target.y; });
    }

    function zoomed() {
        container.attr("transform", "translate(" + d3.event.translate + ")scale(" + d3.event.scale + ")");
    }

    function dragstart(d) {
        d3.event.sourceEvent.stopPropagation();
        d3.select(this).classed("fixed", d.fixed = true);
    }

    function dragend(d) {
        d3.event.sourceEvent.stopPropagation();
        d3.select(this).classed("fixed", d.fixed = false);
    }

</script>
{% endblock %}